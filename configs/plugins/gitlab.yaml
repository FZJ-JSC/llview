# Copyright (c) 2023 Forschungszentrum Juelich GmbH.
# This file is part of LLview. 
#
# This is an open source software distributed under the GPLv3 license. More information see the LICENSE file at the top level.
#
# Contributions must follow the Contributor License Agreement. More information see the CONTRIBUTING.md file at the top level.
#
# Contributors:
#    Filipe Guimar√£es (Forschungszentrum Juelich GmbH) 

# Example configuration for a benchmark of 'application'
application:
  host: 'https://gitlab.jsc.fz-juelich.de/project/application'
  token: "some_token" # Token with at minimum "Role: Reporter" and "scope: read_repo"
  branch: "some_branch" # If the results are not on the master/main branch, it can be changed
  sources:
    folders: 
      - 'folder1'
      - 'folder2'
    files:
      - 'folder3/file1.csv'
    # Files can be excluded or included (in this order) using regex patterns:
    exclude:
      - '.*.json'
    include:
      - '.*pattern.*\.csv'

  # The 'metrics' section defines ALL data points (parameters, measurements, annotations).
  # Usage (Table column vs. Graph curve) is defined in the 'table' and 'plots' sections below.
  metrics:
    # --- Identification Parameters ---
    systemname: 
      type: str  # Type str is the default, when it is not given
      from: filename # Values can be obtained from the filename. In this case, a regex must be given.
      regex: '(.+?)_.+?\.csv' # The group given in (...) is used for the parameter
      description: 'System where the benchmark was run' # Description to be shown when hovering over header
    
    queue:
      from: content # 'from: content' is the default (reads from CSV header matching the key name)
      type: str
      description: 'Slurm partition'

    # --- Calculated Parameter ---
    nodes:
      # Values can also be obtained from calculations of other values. 
      # The calculations are based on the metric keys (not necessarily CSV headers).
      # Note: 'Distributed Processes' etc. must also be defined in this list if used here.
      # from: "'Distributed Processes'*'Threads per Processes'/'Number of CPUs per Node'"
      type: int
      header: nodes

    # --- Grouping Parameters (Previously 'kind: graph') ---
    taskspernode:
      from: content
      type: int
      header: taskspernode # The header/key to be read from the file
    
    threadspertask:
      from: content
      type: int

    # --- Measured Values ---
    ts: # 'ts' (timestamp) is mandatory for the X-axis of graphs
      from: filename
      regex: '.+?_(.+?)\.csv'
      type: ts # Specific type for timestamps
    
    runtime:
      type: float
      header: runtime[s] # The header/key to be read from the file
    
    performance:
      type: float
      header: performance[Gflops]

    # --- Annotation Metadata ---
    jobid:
      type: str
    
    gitcommit:
      header: 'HPCG git commit'
      regex: '(^.{0,8}).*' # A regex can be given to clean/shorten str values

  # -----------------------------------------------------------------------
  # Visualization Configuration
  # -----------------------------------------------------------------------

  # Parameters that define the rows of the summary table
  table:
    - systemname
    - queue

  # Global settings for all plots
  plot_settings:
    # group_by: metrics used to split data into different curves
    group_by:
      - nodes
      - taskspernode
      - threadspertask
    # annotations: metrics to show on hover
    annotations:
      - jobid
      - gitcommit
    # Changing colors and styles of the graphs
    colors:
      colormap: 'Paired' # Qualitative colormap (Default: tab10)
      sort_strategy: 'interleave_even_odd' # Options: 'standard' (Default), 'reverse', 'interleave_even_odd', 'center_out'
      skip: # Colours to skip (Default: [])
        - '#ffff99'
    styles: # Styles for the traces (passed to plotly.js scatter plot)
      mode: 'lines+markers'  # Overwrite default 'markers'
      marker:
        size: 8              # Overwrite default marker size
        opacity: 0.9         # Overwrite default opacity
      line:                  # Add a completely new key
        width: 2

  # Definitions of the specific graphs to generate
  plots:
    - x: ts
      y: runtime
    - x: ts
      y: performance